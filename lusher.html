<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Test des couleurs de Lüsher - Version francaise</title>
    <meta name="author" content="Tanguy Bodin-Hullin">
    <meta name="translator" content="Tanguy Bodin-Hullin">
    <meta name="last-update" content="24/03/2020">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="./assets/css/styles.css">
    <!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
<!--
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
-->
<style></style>
  </head>
  <body class="text-center" cz-shortcut-listen="true">


	<div class="choices cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">
    <h3 class="cover-heading welcome">Test des couleurs de Max Lüscher</h3>
    <!-- <h2 class="choices cover-heading">Résultats :</h2> -->
    <div class="row">

    <!-- BEGINNING : LEFT CARD -->
    <div id="saisie" class="col-sm-6">
      <div class="card">
        <div class="card-body">
      <div class="form-group row">
          <label for="NameSelect" class="col-sm-4">1) Indiquez votre prénom :</label>
          <select id="NameSelect" class="form-control col-sm-7">
            <option value="Anonyme" selected>Choisissez ici</option>
            <option value="TBH">Tanguy</option>
            <option value="AT">Anne</option>
            <option value="Anonyme">...</option>
          </select>
       </div>
       <p class="instruction card-text">2) Cliquez sur la couleur que vous aimez le plus.</p>
     </div>
   </div>
  </div>

  <!-- RESULTS : LEFT CARD -->
  <div id="synthese" class="col-sm-6">
    <div class="card choices">
      <div class="card-body">
        <h5 class="card-title">Synthèse des résultats :</h5>
        <!-- <p class="card-text">With supportional content.</p> -->
        <div class="row">
          <div id="name" class="col-sm-6"></div>
          <div id="date" class="col-sm-6"></div>
        </div>
        <form>
          <div class="form-group row">
            <div class="col-sm-6">
              <input id="colors" type="text" readonly class="form-control-plaintext form-control-sm" size="8" value="">
            </div>
            <div class="col-sm-6">
              <input id="idcolors" type="text" readonly class="form-control-plaintext form-control-sm" size="8" value="">
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- RIGHT CARD -->
  <div class="col-sm-6">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Choix de couleurs :</h5>
          <div class="form-group row">
            <div class="col-sm-6">
              <!-- <label for="colors" class="col-sm-12 col-form-label">Choix de couleurs :</label>-->
              <!-- nuancier de couleurs permettant de voir le résultat -->
                <div id="nuancier" style="width:160px; height:23px; background-color:#eeeeee; border:1px solid blue;">
                  <div id="col1" class="d-inline-block nuance" style=""></div>
                  <div id="col2" class="d-inline-block nuance" style=""></div>
                  <div id="col3" class="d-inline-block nuance" style=""></div>
                  <div id="col4" class="d-inline-block nuance" style=""></div>
                  <div id="col5" class="d-inline-block nuance" style=""></div>
                  <div id="col6" class="d-inline-block nuance" style=""></div>
                  <div id="col7" class="d-inline-block nuance" style=""></div>
                  <div id="col8" class="d-inline-block nuance" style=""></div>
                </div>
                <input id="colors2" type="text" readonly class="form-control-plaintext form-control-sm" size="8" value="">
                <!-- <input id="idcolors2" type="text" readonly class="form-control-plaintext form-control-sm" size="8" value=""> -->
            </div>
            <div class="col-sm-6">
              <input type="submit" class="btn btn-outline-dark" name="toggle1" value="Recommencer le test !" id="toggle1" />

            </div>
          </div>
      </div>
    </div>
  </div>

</div><!-- end row 1 -->

<div class="row">
<!-- ROW 2 : LEFT CARD -->
<div class="col-sm-6">
  <div class="card choices">
    <div id="analyse-so" class="card-body">
      <h5 class="card-title">Tension neuropsychique (Ecart total) :</h5>
      <!-- <p class="card-text">With supporting text.</p> -->
    </div>
  </div>
</div>
<!-- ROW 2 : RIGHT CARD -->
<div class="col-sm-6">
  <div class="card choices">
    <div id="analyse-vk" class="card-body">
      <h5 class="card-title">Coefficient d'activité psycho-végétative :</h5>
      <!-- <p class="card-text">With supporting text.</p> -->
    </div>
  </div>
</div>
</div><!-- end row 2 -->
</div><!-- end container -->

      <div class="" align="center">
           <div class="instruction row">
              <p class="instruction col-sm-12">Cliquez sur la couleur que vous aimez le plus.</p>
           </div>
           <div class="ligneHaute row">
             <div class="col-sm-2"></div>
             <div id="coul3" class="card cardcoul col-sm-2 block1"></div>
             <div id="coul4" class="card cardcoul col-sm-2 block2"></div>
             <div id="coul2" class="card cardcoul col-sm-2 block3"></div>
             <div id="coul5" class="card cardcoul col-sm-2 block4"></div>
             <div class="col-sm-2"></div>
          </div>
          <div class="ligneBasse row">
            <div class="col-sm-2"></div>
            <div id="coul3" class="card cardcoul col-sm-2 block5"></div>
            <div id="coul4" class="card cardcoul col-sm-2 block6"></div>
            <div id="coul2" class="card cardcoul col-sm-2 block7"></div>
            <div id="coul5" class="card cardcoul col-sm-2 block0"></div>
            <div class="col-sm-2"></div>
         </div>
      </div>

  <script type="text/javascript">

    $(function(){
      // $(document).ready(function() { // ANCIEN CODE JQUERY
      var debug = true;
      var fulldebug = false;
      if (debug===true) {
        console.log("Mode debug activé : traces affichées.")
      } else {
        console.log("Mode debug inactif. Vous pouvez l'activer en mettant la variable debug à true.")
      }
      var tabChoices = [];
      var tabColors = [];
      var sColors = "";
      var so = 0; // tension neuropsychique (écart total)
      var vk = 0; // coefficient végétatif
      var numRx = /block(\d)/; // Expression régulière Regex (permet de récupérer le numéro du block)
      var so_interpretation = [
        "Absence de tension neuropsychique improductive. Le sujet testé est actif, ses actions sont diverses et son efficacité est élevée. L'attitude émotionnelle est optimiste. Une maîtrise de soi volontaire est développée. En même temps, la volonté n'est pas un instrument de suppression d'aucune partie de la personnalité; elle harmonise seulement les désirs divers, mais non contradictoires, du sujet. Avec la motivation appropriée, le sujet est capable de travailler intensivement pendant longtemps. Dans les situations extrêmes, il se mobilise efficacement et se concentre sur la tâche.",

        "Niveau insignifiant de tension neuropsychique improductive. Le sujet est dominé par une attitude orientée vers l'activité. Ses ressources énergétiques sont suffisantes pour des accès plus ou moins régulières de suractivité et de tension, inaccessibles à la plupart des autres. Dans les conditions d'une activité motivée (intéressante), il ne rencontre pas de difficultés au stockage et à la reproduction opérationnels des informations à long terme. En général, il ne recherche pas de sensations fortes. Il sort des situations stressantes avec dignité.",

        "Le niveau de tension neuropsychique improductive est moyen. Dans des conditions moyennes, le sujet arrive à faire face à sa charge et à ses obligations. Dans un environnement habituel, il passe sans difficultés importantes du travail aux loisirs et vice-versa (ou d'un type d'activité à l'autre). Si nécessaire, il est capable de surmonter la fatigue par un effort volontaire, mais après cela, un longue période de capacité de travail réduite va apparaître dans ses actes et son bien-être. Pour maintenir sa santé et une bonne performance, il est nécessaire que le sujet de sépare plus clairement et subjectivement ses temps de travail et de repos.",

        "Niveau accru de tension neuropsychique improductive. Le potentiel d'utilité dans l'activité du sujet est très faible. Pour cette raison, il est obligé de se forcer à faire certaines choses irremplaçables. Agir de façon constante sous le contrôle de sa volonté renforce sa fatigue. Un travail long et intensif sera certainement coûteux neuropsychiquement pour le sujet. De plus, sur la durée, le travail sera très inégal en termes de productivité et de qualité. Le contexte émotionnel général se caractérise par une excitabilité, une anxiété et une incertitude accrues. Dans une situation stressante, une rupture d'activité et de comportement est probable.",

        "Tension neuropsychique improductive sévère. Le sujet est extrêmement fatigué. Son attention est facilement distraite par des choses étrangères, tout en étant caractéristique de « rester coincé » dans des expériences émotionnelles. L'absence d'une hiérarchie stable des motifs rend le sujet réactif et flou. L'humeur dans les plus brefs délais peut osciller entre exaltation et dépression, excitation et impuissance. Dans un état émotionnel, l'anxiété, la prémonition de troubles, l'impuissance et le manque de désir de faire quoi que ce soit prévalent. Dans une situation extrême, le sujet n'est pas fiable."
      ];

      var vk_interpretation = ["Épuisement, installation dans l'inaction. Surmenage chronique. Une réponse passive aux difficultés, un manque de préparation au stress et une action adéquate dans des situations stressantes sont caractéristiques. Des mesures de restauration diversifiées et volumineuses sont nécessaires.",

      "Le sujet est adapté pour optimiser sa dépense d'énergie. Besoin modéré de récupération et de repos. Le potentiel énergétique est faible, mais tout à fait suffisant pour une activité réussie dans les conditions de calme dont il a l'habitude. Dans des situations extrêmes, des délais dans l'orientation et dans la prise de décision sont probables.",

      "Mobilisation optimale des ressources physiques et mentales, le sujet est installé dans la mise en action. Dans une situation extrême, le plus probable est une rapidité pour s'orienter et pour prendre des décisions, en rendant les actions faisables et en les réussissant.",

      "Excitation excessive, agitation, tatillonnage. Le niveau d'excitation est excessivement élevé. Il y a des cas fréquents où le sujet fait quelque chose non pas pour son propre bien, mais uniquement pour se décharger. Dans les situations difficiles, des réactions fébriles se forment facilement : impulsivité, impatience, diminution de la maîtrise de soi, tendance à agir de manière irréfléchie, et de façon inconsidérée. Dans les situations extrêmes, le plus probable est une inefficacité de l'action, avec des réactions de panique. Des traitements relaxants et apaisants sont nécessaires."
    ];
    //rouge (3), jaune (4), vert (2), violet (5), bleu (1), marron (6), gris (0), noir (7)
    var autnorma = [3, 4, 2, 5, 1, 6, 0, 7];
    /*
    "0" : {"gris", "G"},
    "1" : {"bleu", "B"},
    "2" : {"vert", "V"},
    "3" : {"rouge", "R"},
    "4" : {"jaune", "J"},
    "5" : {"violet", "F"}, // F pour fuschsia
    "6" : {"marron", "M"},
    "7" : {"noir", "N"}
     */
    var couleursJson = {
      "0" : "G",
      "1" : "B",
      "2" : "V",
      "3" : "R",
      "4" : "J",
      "5" : "F", // F pour fuschsia
      "6" : "M",
      "7" : "N"
    };
    var colorsHtml = {
      "0" : "#8b8878", //"G",
      "1" : "#00008b", //"B",
      "2" : "#228b22", //"V",
      "3" : "#ff4040", //"R",
      "4" : "#ffd700", //"J",
      "5" : "#8b668b", //"F", // F pour fuschsia
      "6" : "#8b4513", //"M",
      "7" : "#1c1c1c"  //"N"
    };
    var instructionString = [
      "Cliquez sur la couleur qui vous attire le plus maintenant.",
      "Parmi les couleurs restantes, laquelle vous attire le plus ?"
    ];
    var sItemNumber = "";
    var itemNumber = 0;
    var iClick = 0;

    // Beginning
    $('div#synthese').hide(); // On enlève les résultats
    $("div.choices").hide(); // On cache les résultats

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        let j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function randomblocks(){
      var colorsHtml = {
        "0" : "#8b8878", //"G",
        "1" : "#00008b", //"B",
        "2" : "#228b22", //"V",
        "3" : "#ff4040", //"R",
        "4" : "#ffd700", //"J",
        "5" : "#8b668b", //"F", // F pour fuschsia
        "6" : "#8b4513", //"M",
        "7" : "#1c1c1c"  //"N"
      };

      for (i = 0; i < 8; i++) {
        $(".block"+(autnorma[i])).css('background-color', colorsHtml[i]);
      }

      // autnorma
      /* 12  / 0,7
                                                AUTNORMA
      .block1 {  background: #00008b; (bleu) } ==> 3
      .block2 {  background: #228b22; (vert) } ==> 4
      .block3 {  background: #ff4040; (rouge) } ==> 2
      .block4 {  background: #ffd700; (jaune) } ==> 5
      .block5 {  background: #8b668b; (F) }    ==> 1
      .block6 {  background: #8b4513; M }      ==> 6
      .block7 {  background: #1c1c1c; N }      ==> 0
      .block0 {  background: #8b8878; G }      ==> 7
      */
    }

    if (debug===true) console.log("autnorma",autnorma)
    // shuffle(autnorma);
    if (debug===true) console.log("autnorma shuffled",autnorma)

    //$('.block').click(function(event) {
    $('.cardcoul').click(function(event) {
        if (fulldebug===true) console.log("block click",$(this));

        // trigger event : On cache le bloc qui a été cliqué
        event.preventDefault();
        $( this ).hide();
        // la classe est écrite comme suit : class="block1 block"
        // On va récupérer le premier élément : ici "block1"
        sItemNumber = numRx.exec(
           $(this).attr('class')
        )[1];
        if (fulldebug===true) console.log("string : ", sItemNumber)
        itemNumber = parseInt(sItemNumber) // convert the string into an integer.
        // On ajoute l'élément au tableau des choix successifs
        tabChoices.push(itemNumber);
        tabColors.push(couleursJson[itemNumber]);

        if (fulldebug===true) console.log("Carte choisie (et cachée) : ", itemNumber)
        if (fulldebug===true) console.log("Choix successifs : ", tabChoices)
        if (fulldebug===true) console.log("Coul HTML : ", colorsHtml[itemNumber])

        // On met les couleurs dans le nuancier de résultat
        iClick = iClick + 1
        $("div#col" + (iClick)).css('background-color', colorsHtml[itemNumber]);

        if (tabChoices.length == 1) {
          $('p.instruction').remove(); // On enlève la première ligne d'instructions
          $("div.instruction").append("<p class=\"instruction col-sm-12\">"+instructionString[1]+"</p>");
        }
        if (tabChoices.length == 8) {
            // Après que le dernier élément ait été cliqué,
            iClick = 0; // Remise à zéro
            showchoices(); // on calcule et on montre les résultats
        }
    });

    // Appui sur le bouton "Recommencer"
    $('#toggle1').click(function() {
        if (debug===true) console.log("#toggle1 click (Recommencer)")

        // On CACHE (hide) :
        $("div#analyse-so").hide();
        $("div#analyse-vk").hide();
        $("div#synthese").hide();

        $("div.choices").hide();
        $("#colors2").hide();
        $('.welcome').hide(); // bloc de titre de bienvenue

        // On AFFICHE (show) :
        $('.cardcoul').show(); // cartes de couleur
        $('div#saisie').show(); // bloc de saisie

        // On réinitialise les couleurs du nuancier
        for (i = 0; i < 8; i++) {
          $("div#col"+(i+1)).css('background-color', 'rgba(0, 123, 255, 0.26)');
        }
        // On réinitialise les tableaux de données temporaires
        tabChoices = [];
        tabColors = [];
        sColors = "";
        // shuffle(autnorma);

        $('p.choices').remove(); // On enlève les résultats
        $('p.instruction').remove(); // On enlève les instructions
        $("div.instruction").append("<p class=\"instruction col-sm-12\">"+instructionString[0]+"</p>");
    });

    // Fonction qui calcule les résultats et gère les affichages
    function showchoices() {
        if (debug===true) console.log("Couleurs choisies : ", tabColors)

        $('.welcome').hide(); // on enlève le bloc de titre de bienvenue
        $('p.instruction').remove(); // on enlève le bloc d'instructions

        // On récupère les données saisies
        var subjectName = ""
        subjectName = $("#NameSelect").children("option:selected").val();
        $('div#saisie').hide(); // on cache le bloc de saisie

        // Initialisation des variables
        so = 0; // Tension neuropsychique (écart par rapport à 0)
        vk = 0; // Coefficient d'activité psycho-végétative
        var so_string = "Résultat lié à la tension neuropsychique";
        var vk_string = "Résultat lié au coefficient d'activité psycho-végétative";
        // Intervalles d'appartenance (pour l'affichage)
        var so_interval = "[]";
        var vk_interval = "[]";
        // Date and time initialisation
        var dt = new Date();
        var datetime = "" + dt.getDate() + "/" + (dt.getMonth()+1)  + "/" + dt.getFullYear() + "   "
            + dt.getHours() + ":" + dt.getMinutes(); // + ":" + dt.getSeconds();

        // Parcours du tableau des choix
        for (var i = 0; i < tabChoices.length; i++) {
            // Pour chaque élément, on ajoute de façon cumulée à so la valeur absolue de la différence
            // entre la norme et la valeur choisie
            if (debug===true) console.log("" + [i] + " " + so + " + ABS(Norme(" + autnorma.indexOf(i) + ")-Choix(" + tabChoices.indexOf(i) + "))")
            so += Math.abs(autnorma.indexOf(i) - tabChoices.indexOf(i));
        }
        if (debug===true) console.log("Tension neuropsychique (Ecart total) : " + so)

        /* Calcul du coefficient végétatif */
        vk = (18 - tabChoices.indexOf(3) - tabChoices.indexOf(4) - 2) / (18 - tabChoices.indexOf(1) - tabChoices.indexOf(2) - 2);
        vk = Math.round(vk * 10) / 10;
        if (debug===true) console.log("Coefficient d'activité végétative : " + vk)

        /* Tension neuropsychique : Sélection de l'interprétation correspondant à l'écart */
        if (so <= 6) {
            so_string = so_interpretation[0];
            so_interval = "[0 <= so <= 6]";
        }
        else if (so <= 12) {
            so_string = so_interpretation[1];
            so_interval = "[6 < so <= 12]";
        }
        else if (so <= 20) {
            so_string = so_interpretation[2];
            so_interval = "[12 < so <= 20]";
        }
        else if (so <= 26) {
            so_string = so_interpretation[3];
            so_interval = "[20 < so <= 26]";
        }
        else if (so <= 32) {
            so_string = so_interpretation[4];
            so_interval = "[26 < so <= 32]";
        }

        // Sélection de l'interprétation pour le coefficient d'activité psycho-végétative
        if (vk <= 0.4) {
            vk_string = vk_interpretation[0];
            vk_interval = "[0 <=  vk <= 0.4]";
        }
        else if (vk <= 0.8) {
            vk_string = vk_interpretation[1];
            vk_interval = "[0.4 < vk <= 0.8]";
        }
        else if (vk <= 1.9) {
            vk_string = vk_interpretation[2];
            vk_interval = "[0.8 < vk <= 1.9]";
        }
        else if (vk <= 5) {
            vk_string = vk_interpretation[3];
            vk_interval = "[1.9 < vk <= 5]";
        }

        /* BLOC DE SYNTHESE */
        $("div#name").append("<p class=\"choices\">Nom : " + subjectName + "</p>");
        $("div#date").append("<p class=\"choices\">Date : " + datetime + "</p>");
        $("input#colors").attr('value',"" + tabColors.join(""));
        $("input#idcolors").attr('value',"" + tabChoices.join(""));
        $("div#synthese").show();

        /* BLOC COULEURS */
        $("input#colors2").attr('value',"" + tabColors.join(""));
        $("input#idcolors2").attr('value',"" + tabChoices.join("-"));
        $("#colors2").show();

        /* BLOC ANALYSE SO */
        $("div#analyse-so").append("<p class=\"choices\">SО = " + so + "<span style=\"font-weight:lighter;\">    avec " + so_interval + "</span></p>");
        $("div#analyse-so").append("<p class=\"choices description\">   " + so_string + "</p>");
        $("div#analyse-so").show();

        /* BLOC ANALYSE VK */
        $("div#analyse-vk").append("<p class=\"choices\">CК = " + vk + "<span style=\"font-weight:lighter;\">    avec " + vk_interval +"</span></p>");
        $("div#analyse-vk").append("<p class=\"choices description\">   " + vk_string + "</p>");
        $("div#analyse-vk").show();

        // On affiche les résultats restants
        // TODO : est-ce nécessaire ???
        $("div.choices").show();

      }

    }); // fin JQuery
    </script>
  </body>
</html>
